<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tip 100 - Creating an Email Subscription with Azure Functions - Sending Emails | Azure Tips and Tricks</title>
    <meta name="description" content="">
    <link rel="apple-touch-icon" sizes="57x57" href="/AzureTipsAndTricks/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/AzureTipsAndTricks/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/AzureTipsAndTricks/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/AzureTipsAndTricks/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/AzureTipsAndTricks/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/AzureTipsAndTricks/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/AzureTipsAndTricks/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/AzureTipsAndTricks/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/AzureTipsAndTricks/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/AzureTipsAndTricks/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/AzureTipsAndTricks/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/AzureTipsAndTricks/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/AzureTipsAndTricks/favicon-16x16.png">
  <link rel="manifest" href="/AzureTipsAndTricks/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/AzureTipsAndTricks/assets/css/0.styles.2190fd11.css" as="style"><link rel="preload" href="/AzureTipsAndTricks/assets/js/app.2e99b779.js" as="script"><link rel="preload" href="/AzureTipsAndTricks/assets/js/4.42b4ecad.js" as="script"><link rel="preload" href="/AzureTipsAndTricks/assets/js/12.9429b2c2.js" as="script"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/10.23222809.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/100.c3f7ad2b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/101.5cec8a7b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/102.625cd5f8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/103.d3596cb8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/104.264a6e3f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/105.68196946.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/106.5881d07c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/107.5e7c30a7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/108.889333bd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/109.d02cb5aa.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/11.6c3c3634.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/110.749cc4af.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/111.ace4b528.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/112.c6856812.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/113.5bd91ed4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/114.3a5a894c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/115.f91703fc.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/116.02f8e8fb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/117.1b7e04c5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/118.11da1178.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/119.af2a27bb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/120.98ce0287.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/121.89509727.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/122.94de9a67.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/123.7ea01c8d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/124.0a893554.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/125.d50613e9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/126.6b224796.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/127.ad90f56e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/128.f07ae2de.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/129.6f792b77.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/13.207ee72c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/130.c1bdaa01.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/131.689f6a24.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/132.5439db66.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/133.e3f005eb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/134.902670fe.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/135.d2ca678d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/136.01d5f1eb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/137.c773b362.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/138.9b974475.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/139.3cf29514.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/14.ccbbcfb7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/140.52358987.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/141.ecd2c379.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/142.3fd8ba17.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/143.b9c82178.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/144.ed5a6e68.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/145.8c17d1c1.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/146.2e383f11.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/147.583547e0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/148.847f71bc.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/149.cf14a923.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/15.557252a1.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/150.fc417edc.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/151.49158ba1.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/152.41fbddd9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/153.6d62698b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/154.dcb65f1b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/155.c47f4f94.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/156.15d340ca.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/157.f4d3c03c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/158.a2191408.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/159.9fdd6cee.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/16.7f84482e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/160.42d8dcae.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/161.3b917d93.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/162.dbdca4ef.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/163.3d221f2e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/164.63cb3cc5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/165.9822b71c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/166.62f0b1c0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/167.cb471ba8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/168.4cb569fa.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/169.53f82512.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/17.7e91a93a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/170.81786125.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/171.3205146a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/172.a918c52d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/173.27680cd7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/174.e95715fd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/175.c387ad62.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/176.8412175a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/177.b31b05e5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/178.aa19cfc7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/179.87d2a280.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/18.7bef39fb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/180.3286ba7f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/181.de48653e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/182.5dbe3cfb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/183.4c16f6ca.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/184.522bf206.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/185.b4f8bfaa.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/186.9b109863.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/187.ac810de4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/188.2b10cbf2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/189.404f5a16.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/19.d813aff8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/190.07e256ae.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/191.0d671bdf.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/20.a8190f46.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/21.613cb981.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/22.5468b0cd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/23.4e3164f9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/24.57e06756.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/25.e0b971c5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/26.139b7914.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/27.349e78c4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/28.b33b3ecf.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/29.ccabc6a2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/3.64c8908f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/30.21aa3b90.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/31.5aaa7596.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/32.28b6a589.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/33.c16c5977.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/34.8a9161df.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/35.5d15c3b5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/36.e2d06d32.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/37.523e6237.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/38.9ca06ca3.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/39.aa4cfb1b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/40.4662cb4e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/41.08b3e6bd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/42.8ec9ac01.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/43.2e1b9a64.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/44.dc17ca22.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/45.edb2a6fd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/46.26f8abef.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/47.ec61cc18.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/48.c42d5aee.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/49.e48448f4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/5.058e843f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/50.b09e34ff.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/51.248804b5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/52.1df1a7b7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/53.4c46f7ea.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/54.c5731615.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/55.4320e7b9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/56.6c4e07a0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/57.ec7deefa.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/58.e61b3b32.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/59.654dd4a5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/6.f1e92f96.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/60.ac93c7a8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/61.b9a91309.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/62.11f146c8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/63.bd5b4bd4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/64.f9260f13.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/65.2141829c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/66.5da239ba.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/67.e4ef6762.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/68.3e6d758b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/69.effae857.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/7.ee00b141.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/70.b7adb426.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/71.48fd58e7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/72.e40391c2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/73.45591f14.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/74.b0c0f4fb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/75.04ed7196.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/76.572becc7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/77.b86d5096.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/78.969ebd2d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/79.bc30ac92.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/8.5287ec51.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/80.55de8772.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/81.0f7b971e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/82.a2bf5b79.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/83.ae13f7a9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/84.c6988842.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/85.b63ba098.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/86.00803912.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/87.a52dc9d9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/88.09a3833c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/89.484e264a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/9.33d043c0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/90.1f70aa86.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/91.17e85a16.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/92.7c6bc3a8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/93.4baaa6f0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/94.8874df99.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/95.f4b7a309.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/96.0cde166d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/97.dc9a7e4b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/98.0bd33e90.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/99.8a8e2582.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/vendors~docsearch.9a8918f9.js">
    <link rel="stylesheet" href="/AzureTipsAndTricks/assets/css/0.styles.2190fd11.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/AzureTipsAndTricks/" class="home-link router-link-active"><!----> <span class="site-name">Azure Tips and Tricks</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/AzureTipsAndTricks/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://videos.azuredev.tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Videos
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/AzureTipsAndTricks/#site-map" class="nav-link">eBooks</a></div><div class="nav-item"><a href="https://github.com/Microsoft/AzureTipsAndTricks/issues/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Questions?
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://microsoft.github.io/AzureTipsAndTricks/rss.xml" class="nav-link">
  RSS Feed
</a></div> <a href="https://github.com/microsoft/azuretipsandtricks" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/AzureTipsAndTricks/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://videos.azuredev.tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Videos
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/AzureTipsAndTricks/#site-map" class="nav-link">eBooks</a></div><div class="nav-item"><a href="https://github.com/Microsoft/AzureTipsAndTricks/issues/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Questions?
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://microsoft.github.io/AzureTipsAndTricks/rss.xml" class="nav-link">
  RSS Feed
</a></div> <a href="https://github.com/microsoft/azuretipsandtricks" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Home</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/AzureTipsAndTricks/" class="sidebar-link">Welcome</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Tips</span> <!----></p> <ul class="sidebar-group-items"></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Recently Added</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>AzCopy</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>App Service</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CLI</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cloud Shell</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cognitive Services</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Containers</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cosmos DB</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>DevOps</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Functions</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/AzureTipsAndTricks/blog/tip35.html" class="sidebar-link">Tip 35 - Work with the Azure Functions File System using the Console</a></li><li><a href="/AzureTipsAndTricks/blog/tip36.html" class="sidebar-link">Tip 36 - Quickly Renew or Revoke Azure Functions Keys</a></li><li><a href="/AzureTipsAndTricks/blog/tip50.html" class="sidebar-link">Tip 50 - Create an Azure Functions project with Visual Studio Code</a></li><li><a href="/AzureTipsAndTricks/blog/tip51.html" class="sidebar-link">Tip 51 - Debug Azure Functions with Visual Studio Code</a></li><li><a href="/AzureTipsAndTricks/blog/tip52.html" class="sidebar-link">Tip 52 - Deploy Azure Functions with Visual Studio Code</a></li><li><a href="/AzureTipsAndTricks/blog/tip61.html" class="sidebar-link">Tip 61 - Java in Azure Function with VS Code</a></li><li><a href="/AzureTipsAndTricks/blog/tip62.html" class="sidebar-link">Tip 62 - Force HTTPS in Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip63.html" class="sidebar-link">Tip 63 - Open an existing Azure Function in Visual Studio</a></li><li><a href="/AzureTipsAndTricks/blog/tip64.html" class="sidebar-link">Tip 64 - Using a different route prefix with Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip94.html" class="sidebar-link">Tip 94 - Customize an Azure Functions Endpoint in Seconds</a></li><li><a href="/AzureTipsAndTricks/blog/tip97.html" class="sidebar-link">Tip 97 - Generate a Weekly Digest Email for a Blog using Azure Functions, SendGrid and Azure Storage</a></li><li><a href="/AzureTipsAndTricks/blog/tip98.html" class="sidebar-link">Tip 98 - Creating an Email Subscription with Azure Functions - Storing Emails</a></li><li><a href="/AzureTipsAndTricks/blog/tip99.html" class="sidebar-link">Tip 99 - Creating an Email Subscription with Azure Functions - Writing the Frontend</a></li><li><a href="/AzureTipsAndTricks/blog/tip100.html" class="active sidebar-link">Tip 100 - Creating an Email Subscription with Azure Functions - Sending Emails</a></li><li><a href="/AzureTipsAndTricks/blog/tip130.html" class="sidebar-link">Tip 130 - Manage Application Settings for Azure Functions within Visual Studio</a></li><li><a href="/AzureTipsAndTricks/blog/tip133.html" class="sidebar-link">Tip 133 - Use the Azure Portal for Durable Functions Development</a></li><li><a href="/AzureTipsAndTricks/blog/tip134.html" class="sidebar-link">Tip 134 - Use Run-From-Zip to deploy a site to Azure Web Apps or Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip135.html" class="sidebar-link">Tip 135 - Use Run-From-Zip without Azure Storage to deploy a site to Azure Web Apps or Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip136.html" class="sidebar-link">Tip 136 - Quickly Restore your Local Settings File for Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip147.html" class="sidebar-link">Tip 147 - Run TSQL on an Azure SQL database with Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip148.html" class="sidebar-link">Tip 148 - Share Business Logic between Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip157.html" class="sidebar-link">Tip 157 - Part 1 Create Thumbnail Images with Azure Functions and Azure Storage</a></li><li><a href="/AzureTipsAndTricks/blog/tip158.html" class="sidebar-link">Tip 158 - Part 2 Create Thumbnail Images with Azure Functions and Azure Storage</a></li><li><a href="/AzureTipsAndTricks/blog/tip161.html" class="sidebar-link">Tip 161 - Change the Azure Function runtime version after Deployment</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HD Insight</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>iOS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>IoT</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Key Vault</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Logic Apps</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Media Services</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Portal</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>PowerShell</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Productivity</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SAP</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SendGrid</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SignalR</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SQL</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Storage</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Virtual Machines</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>VNET</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content default"><h4 id="where-are-we"><a href="#where-are-we" aria-hidden="true" class="header-anchor">#</a> Where are we?</h4> <p><strong>Full Source Code</strong> The source code for the app can be found on <a href="https://github.com/mbcrump/EmailSubscription" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>This blog post is part of a series on how to generate a weekly digest email for a blog using Azure Functions, SendGrid and Azure Storage.</p> <ul><li><a href="http://www.michaelcrump.net/azure-tips-and-tricks97/" target="_blank" rel="noopener noreferrer">Part 1 - What we're going to build and how to build it<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.michaelcrump.net/azure-tips-and-tricks98/" target="_blank" rel="noopener noreferrer">Part 2 - Storing Emails using Azure Table Storage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.michaelcrump.net/azure-tips-and-tricks99/" target="_blank" rel="noopener noreferrer">Part 3 - Writing the Frontend with HTML5 and jQuery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.michaelcrump.net/azure-tips-and-tricks100/" target="_blank" rel="noopener noreferrer">Part 4 - Sending Emails with Sendgrid and Azure Functions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>We're trying to build a Email Subscription similar to the following. If you want to catch up, then read the previous posts.</p> <img src="/AzureTipsAndTricks/files/emailsub1.png"> <h4 id="generating-and-sending-emails"><a href="#generating-and-sending-emails" aria-hidden="true" class="header-anchor">#</a> Generating and Sending Emails</h4> <p>In our last post, we left off by creating a frontend that used HTML5, jQuery and some light CSS work. When the user filled out the form and clicked <strong>Submit</strong>, then it would check to ensure the email is valid and then use an AJAX call to POST the data to our Azure Function that we wrote in part 2. Today, we'll wrap things up by using SendGrid, C# and Azure Functions to send emails every Sunday at 9:30AM.</p> <h4 id="use-the-azure-functions-template-inside-of-visual-studio"><a href="#use-the-azure-functions-template-inside-of-visual-studio" aria-hidden="true" class="header-anchor">#</a> Use the Azure Functions Template inside of Visual Studio</h4> <p>Return to the project we created earlier and right-click the project and select <strong>Add Item</strong> and select <strong>Azure Functions</strong>. Now give it a name such as <strong>SendEmail</strong> and select <strong>Timer Trigger</strong> and provide the following schedule <strong>0 30 9 * * SUN</strong>.</p> <img src="/AzureTipsAndTricks/files/emailsub5.png"> <p>We'll begin by declaring the feedurl and looping through the feed to collect the last 7 days worth of blog posts and append them to a string. Here we are using SyndicationClient to make easier work of everything. We could also use StringBuilder but for now this will do.</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">string</span> feedurl <span class="token operator">=</span> <span class="token string">&quot;https://www.michaelcrump.net/feed.xml&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> last7days <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">XmlReader</span> reader <span class="token operator">=</span> XmlReader<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>feedurl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SyndicationFeed</span> feed <span class="token operator">=</span> SyndicationFeed<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

last7days <span class="token operator">=</span> last7days <span class="token operator">+</span> <span class="token string">&quot;&lt;b&gt;New updates in the last 7 days:&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">SyndicationItem</span> item <span class="token keyword">in</span> feed<span class="token punctuation">.</span>Items<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now <span class="token operator">-</span> item<span class="token punctuation">.</span>PublishDate<span class="token punctuation">)</span><span class="token punctuation">.</span>TotalDays <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        last7days <span class="token operator">=</span> last7days <span class="token operator">+</span> <span class="token string">&quot;&lt;a href=\&quot;&quot;</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>Links<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Uri <span class="token operator">+</span> <span class="token string">&quot;\')&quot;</span><span class="token operator">&gt;</span><span class="token string">&quot; + item.Title.Text + &quot;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>&quot;<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>       
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>We'll now grab a list of our <strong>EmailSubscribers</strong> that is in our Azure Storage Table.</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">CloudStorageAccount</span> storageAccount <span class="token operator">=</span> CloudStorageAccount<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">&quot;TableStorageConnString&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CloudTableClient</span> tableClient <span class="token operator">=</span> storageAccount<span class="token punctuation">.</span><span class="token function">CreateCloudTableClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CloudTable</span> table <span class="token operator">=</span> tableClient<span class="token punctuation">.</span><span class="token function">GetTableReference</span><span class="token punctuation">(</span><span class="token string">&quot;MCBlogSubscribers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
table<span class="token punctuation">.</span><span class="token function">CreateIfNotExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>We'll need to add this helper method outside of the <strong>Run</strong> method we are currently in. It will search for the <strong>Partition Key</strong> that matches what we sent in our POST request in post #2.</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> <span class="token function">GetAllEmailAddresses</span><span class="token punctuation">(</span><span class="token class-name">CloudTable</span> table<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> retList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    TableQuery<span class="token operator">&lt;</span>EmailEntity<span class="token operator">&gt;</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">TableQuery</span><span class="token punctuation">&lt;</span><span class="token class-name">EmailEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>TableQuery<span class="token punctuation">.</span><span class="token function">GenerateFilterCondition</span><span class="token punctuation">(</span><span class="token string">&quot;PartitionKey&quot;</span><span class="token punctuation">,</span> QueryComparisons<span class="token punctuation">.</span>Equal<span class="token punctuation">,</span> <span class="token string">&quot;SendEmailToReaders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">EmailEntity</span> emailname <span class="token keyword">in</span> table<span class="token punctuation">.</span><span class="token function">ExecuteQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        retList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>emailname<span class="token punctuation">.</span>EmailAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> retList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Now we need to send our emails. This is where it gets slightly tricky as we need to use the <strong>X-SMTPAPI</strong> header to hide the email address of all our users. Search <strong>NuGet</strong> and add <strong>Sendgrid.SmtpApi</strong> to your references. We'll need to get our SendGrid Username and Password and pass them in the credentials.</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> header <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">SmtpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SmtpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>Port <span class="token operator">=</span> <span class="token number">587</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>Host <span class="token operator">=</span> <span class="token string">&quot;smtp.sendgrid.net&quot;</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>Timeout <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>DeliveryMethod <span class="token operator">=</span> SmtpDeliveryMethod<span class="token punctuation">.</span>Network<span class="token punctuation">;</span>
client<span class="token punctuation">.</span>UseDefaultCredentials <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>Credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>NetworkCredential</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">&quot;SendGridUserName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ConfigurationManager<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">&quot;SendGridSecret&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Now we need to form our email message. We'll pull the list of email addresses from our Azure Storage Table and force the HTML view to ensure our links are clickable and tell those that don't have HTML enabled, to enable it. 😃</p> <p>Finally, we'll send the email asynchronously and dispose of our client.</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">MailMessage</span> mail <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MailMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> recipientlist <span class="token operator">=</span> <span class="token function">GetAllEmailAddresses</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">;</span>
header<span class="token punctuation">.</span><span class="token function">SetTo</span><span class="token punctuation">(</span>recipientlist<span class="token punctuation">)</span><span class="token punctuation">;</span>
mail<span class="token punctuation">.</span>From <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MailAddress</span><span class="token punctuation">(</span><span class="token string">&quot;michael@michaelcrump.net&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Azure Tips and Tricks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mail<span class="token punctuation">.</span>To<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;no-reply@michaelcrump.net&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mail<span class="token punctuation">.</span>Subject <span class="token operator">=</span> <span class="token string">&quot;Weekly Digest for MichaelCrump.net Blog&quot;</span><span class="token punctuation">;</span>
mail<span class="token punctuation">.</span>BodyEncoding <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">;</span>
mail<span class="token punctuation">.</span>SubjectEncoding <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">;</span>

<span class="token class-name">AlternateView</span> htmlView <span class="token operator">=</span> AlternateView<span class="token punctuation">.</span><span class="token function">CreateAlternateViewFromString</span><span class="token punctuation">(</span>last7days<span class="token punctuation">)</span><span class="token punctuation">;</span>
htmlView<span class="token punctuation">.</span>ContentType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Mime<span class="token punctuation">.</span>ContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mail<span class="token punctuation">.</span>AlternateViews<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>htmlView<span class="token punctuation">)</span><span class="token punctuation">;</span>
mail<span class="token punctuation">.</span>Body <span class="token operator">=</span> <span class="token string">&quot;Please enable HTML in order to view the message&quot;</span><span class="token punctuation">;</span>

mail<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;X-SMTPAPI&quot;</span><span class="token punctuation">,</span> header<span class="token punctuation">.</span><span class="token function">JsonString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">SendMailAsync</span><span class="token punctuation">(</span>mail<span class="token punctuation">)</span><span class="token punctuation">;</span>

mail<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Before we publish the updates to our Azure Function, we'll need to ensure that users can unsubscribe easily. I was originally going to handle this myself, but it is super simple with SendGrid.</p> <p>Log into your <a href="https://app.sendgrid.com/" target="_blank" rel="noopener noreferrer">SendGrid<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> account and go to <strong>Settings</strong> and then <strong>Tracking</strong> and you'll see <strong>Subscription Tracking</strong>. If you turn this on, then it will add the unsubscribe link for you and manage those users. NEAT!</p> <img src="/AzureTipsAndTricks/files/emailsubtracking.png"> <p>Now is a great time to go ahead and publish our Azure Function. Simply right click the project name and select Publish, then Publish again as shown below.</p> <img src="/AzureTipsAndTricks/files/emailsub8.png"> <p>Once it deploys, if you click on the <strong>SendEmail</strong> function, then you can run it (note you can also run it inside of Visual Studio).</p> <p>It should say that it compeleted successfully, and now go check your email and it should be working.</p> <img src="/AzureTipsAndTricks/files/emailcompletedsuccessfully.png"> <p>And we're done! If something isn't working then check the source code for the app on <a href="https://github.com/mbcrump/EmailSubscription" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and if you have any questions then ping me on <a href="http://twitter.com/mbcrump" target="_blank" rel="noopener noreferrer">twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. You should follow me btw, I might have another tip and trick to share!</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/microsoft/azuretipsandtricks/edit/master/blog/tip100.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/AzureTipsAndTricks/blog/tip99.html" class="prev">
          Tip 99 - Creating an Email Subscription with Azure Functions - Writing the Frontend
        </a></span> <span class="next"><a href="/AzureTipsAndTricks/blog/tip130.html">
          Tip 130 - Manage Application Settings for Azure Functions within Visual Studio
        </a>
        →
      </span></p></div> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/AzureTipsAndTricks/assets/js/app.2e99b779.js" defer></script><script src="/AzureTipsAndTricks/assets/js/4.42b4ecad.js" defer></script><script src="/AzureTipsAndTricks/assets/js/12.9429b2c2.js" defer></script>
  </body>
</html>
